# Firebase Auth Kit ç¤ºä¾‹ Makefile
# æä¾›ä¾¿æ·çš„ç¯å¢ƒå˜é‡ç®¡ç†å‘½ä»¤

.PHONY: help setup run-dev run-prod clean

# é»˜è®¤ç›®æ ‡
help:
	@echo "Firebase Auth Kit ç¤ºä¾‹ - å¯ç”¨å‘½ä»¤ï¼š"
	@echo ""
	@echo "  setup      - è®¾ç½®ç¯å¢ƒå˜é‡æ–‡ä»¶"
	@echo "  run-dev    - å¼€å‘æ¨¡å¼è¿è¡Œï¼ˆæ˜¾ç¤ºé…ç½®è­¦å‘Šï¼‰"
	@echo "  run-prod   - Web å¹³å°ç”Ÿäº§æ¨¡å¼è¿è¡Œ"
	@echo "  run-android - Android å¹³å°è¿è¡Œ"
	@echo "  run-ios    - iOS å¹³å°è¿è¡Œ"
	@echo "  run-macos  - macOS å¹³å°è¿è¡Œ"
	@echo "  run-windows - Windows å¹³å°è¿è¡Œ"
	@echo "  clean      - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  help       - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"

# è®¾ç½®ç¯å¢ƒå˜é‡æ–‡ä»¶
setup:
	@echo "ğŸ“ è®¾ç½®ç¯å¢ƒå˜é‡æ–‡ä»¶..."
	@if [ ! -f .env ]; then \
		cp env.example .env; \
		echo "âœ… å·²åˆ›å»º .env æ–‡ä»¶ï¼Œè¯·ç¼–è¾‘å¹¶å¡«å…¥æ‚¨çš„é…ç½®"; \
	else \
		echo "âš ï¸  .env æ–‡ä»¶å·²å­˜åœ¨"; \
	fi

# å¼€å‘æ¨¡å¼è¿è¡Œ
run-dev:
	@echo "ğŸš€ å¼€å‘æ¨¡å¼è¿è¡Œ..."
	flutter run -d chrome --web-port=8080

# ç”Ÿäº§æ¨¡å¼è¿è¡Œï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
run-prod:
	@echo "ğŸš€ ç”Ÿäº§æ¨¡å¼è¿è¡Œ..."
	@if [ ! -f .env ]; then \
		echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ 'make setup'"; \
		exit 1; \
	fi
	@source .env && flutter run -d chrome --web-port=8080 \
		--dart-define=FIREBASE_WEB_API_KEY="$$FIREBASE_WEB_API_KEY" \
		--dart-define=FIREBASE_WEB_APP_ID="$$FIREBASE_WEB_APP_ID" \
		--dart-define=FIREBASE_PROJECT_ID="$$FIREBASE_PROJECT_ID" \
		--dart-define=FIREBASE_MESSAGING_SENDER_ID="$$FIREBASE_MESSAGING_SENDER_ID" \
		--dart-define=FIREBASE_WEB_AUTH_DOMAIN="$$FIREBASE_WEB_AUTH_DOMAIN" \
		--dart-define=FIREBASE_WEB_STORAGE_BUCKET="$$FIREBASE_WEB_STORAGE_BUCKET" \
		--dart-define=FIREBASE_WEB_MEASUREMENT_ID="$$FIREBASE_WEB_MEASUREMENT_ID" \
		--dart-define=GITHUB_CLIENT_ID="$$GITHUB_CLIENT_ID" \
		--dart-define=GITHUB_CLIENT_SECRET="$$GITHUB_CLIENT_SECRET" \
		--dart-define=GITHUB_CALLBACK_URL="$$GITHUB_CALLBACK_URL" \
		--dart-define=GOOGLE_WEB_CLIENT_ID="$$GOOGLE_WEB_CLIENT_ID" \
		--dart-define=GOOGLE_ANDROID_CLIENT_ID="$$GOOGLE_ANDROID_CLIENT_ID" \
		--dart-define=GOOGLE_IOS_CLIENT_ID="$$GOOGLE_IOS_CLIENT_ID" \
			--dart-define=FACEBOOK_APP_ID="$$FACEBOOK_APP_ID" \
		--dart-define=FACEBOOK_APP_SECRET="$$FACEBOOK_APP_SECRET" \
		--dart-define=FACEBOOK_APP_ID="$$FACEBOOK_APP_ID" \
		--dart-define=FACEBOOK_APP_SECRET="$$FACEBOOK_APP_SECRET"

# Android å¹³å°è¿è¡Œ
run-android:
	@echo "ğŸš€ Android å¹³å°è¿è¡Œ..."
	@if [ ! -f .env ]; then \
		echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ 'make setup'"; \
		exit 1; \
	fi
	@source .env && flutter run -d android \
		--dart-define=FIREBASE_ANDROID_API_KEY="$$FIREBASE_ANDROID_API_KEY" \
		--dart-define=FIREBASE_ANDROID_APP_ID="$$FIREBASE_ANDROID_APP_ID" \
		--dart-define=FIREBASE_PROJECT_ID="$$FIREBASE_PROJECT_ID" \
		--dart-define=FIREBASE_MESSAGING_SENDER_ID="$$FIREBASE_MESSAGING_SENDER_ID" \
		--dart-define=FIREBASE_ANDROID_STORAGE_BUCKET="$$FIREBASE_ANDROID_STORAGE_BUCKET" \
		--dart-define=GITHUB_CLIENT_ID="$$GITHUB_CLIENT_ID" \
		--dart-define=GITHUB_CLIENT_SECRET="$$GITHUB_CLIENT_SECRET" \
		--dart-define=GITHUB_CALLBACK_URL="$$GITHUB_CALLBACK_URL" \
		--dart-define=GOOGLE_WEB_CLIENT_ID="$$GOOGLE_WEB_CLIENT_ID" \
		--dart-define=GOOGLE_ANDROID_CLIENT_ID="$$GOOGLE_ANDROID_CLIENT_ID" \
		--dart-define=GOOGLE_IOS_CLIENT_ID="$$GOOGLE_IOS_CLIENT_ID" \
			--dart-define=FACEBOOK_APP_ID="$$FACEBOOK_APP_ID" \
		--dart-define=FACEBOOK_APP_SECRET="$$FACEBOOK_APP_SECRET"

# iOS å¹³å°è¿è¡Œ
run-ios:
	@echo "ğŸš€ iOS å¹³å°è¿è¡Œ..."
	@if [ ! -f .env ]; then \
		echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ 'make setup'"; \
		exit 1; \
	fi
	@source .env && flutter run -d ios \
		--dart-define=FIREBASE_IOS_API_KEY="$$FIREBASE_IOS_API_KEY" \
		--dart-define=FIREBASE_IOS_APP_ID="$$FIREBASE_IOS_APP_ID" \
		--dart-define=FIREBASE_PROJECT_ID="$$FIREBASE_PROJECT_ID" \
		--dart-define=FIREBASE_MESSAGING_SENDER_ID="$$FIREBASE_MESSAGING_SENDER_ID" \
		--dart-define=FIREBASE_IOS_STORAGE_BUCKET="$$FIREBASE_IOS_STORAGE_BUCKET" \
		--dart-define=GITHUB_CLIENT_ID="$$GITHUB_CLIENT_ID" \
		--dart-define=GITHUB_CLIENT_SECRET="$$GITHUB_CLIENT_SECRET" \
		--dart-define=GITHUB_CALLBACK_URL="$$GITHUB_CALLBACK_URL" \
		--dart-define=GOOGLE_WEB_CLIENT_ID="$$GOOGLE_WEB_CLIENT_ID" \
		--dart-define=GOOGLE_ANDROID_CLIENT_ID="$$GOOGLE_ANDROID_CLIENT_ID" \
		--dart-define=GOOGLE_IOS_CLIENT_ID="$$GOOGLE_IOS_CLIENT_ID" \
			--dart-define=FACEBOOK_APP_ID="$$FACEBOOK_APP_ID" \
		--dart-define=FACEBOOK_APP_SECRET="$$FACEBOOK_APP_SECRET"

# macOS å¹³å°è¿è¡Œ
run-macos:
	@echo "ğŸš€ macOS å¹³å°è¿è¡Œ..."
	@if [ ! -f .env ]; then \
		echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ 'make setup'"; \
		exit 1; \
	fi
	@source .env && flutter run -d macos \
		--dart-define=FIREBASE_MACOS_API_KEY="$$FIREBASE_MACOS_API_KEY" \
		--dart-define=FIREBASE_MACOS_APP_ID="$$FIREBASE_MACOS_APP_ID" \
		--dart-define=FIREBASE_PROJECT_ID="$$FIREBASE_PROJECT_ID" \
		--dart-define=FIREBASE_MESSAGING_SENDER_ID="$$FIREBASE_MESSAGING_SENDER_ID" \
		--dart-define=FIREBASE_MACOS_STORAGE_BUCKET="$$FIREBASE_MACOS_STORAGE_BUCKET" \
		--dart-define=GITHUB_CLIENT_ID="$$GITHUB_CLIENT_ID" \
		--dart-define=GITHUB_CLIENT_SECRET="$$GITHUB_CLIENT_SECRET" \
		--dart-define=GITHUB_CALLBACK_URL="$$GITHUB_CALLBACK_URL" \
		--dart-define=GOOGLE_WEB_CLIENT_ID="$$GOOGLE_WEB_CLIENT_ID" \
		--dart-define=GOOGLE_ANDROID_CLIENT_ID="$$GOOGLE_ANDROID_CLIENT_ID" \
		--dart-define=GOOGLE_IOS_CLIENT_ID="$$GOOGLE_IOS_CLIENT_ID" \
			--dart-define=FACEBOOK_APP_ID="$$FACEBOOK_APP_ID" \
		--dart-define=FACEBOOK_APP_SECRET="$$FACEBOOK_APP_SECRET"

# Windows å¹³å°è¿è¡Œ
run-windows:
	@echo "ğŸš€ Windows å¹³å°è¿è¡Œ..."
	@if [ ! -f .env ]; then \
		echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ 'make setup'"; \
		exit 1; \
	fi
	@source .env && flutter run -d windows \
		--dart-define=FIREBASE_WINDOWS_API_KEY="$$FIREBASE_WINDOWS_API_KEY" \
		--dart-define=FIREBASE_WINDOWS_APP_ID="$$FIREBASE_WINDOWS_APP_ID" \
		--dart-define=FIREBASE_PROJECT_ID="$$FIREBASE_PROJECT_ID" \
		--dart-define=FIREBASE_MESSAGING_SENDER_ID="$$FIREBASE_MESSAGING_SENDER_ID" \
		--dart-define=FIREBASE_WINDOWS_STORAGE_BUCKET="$$FIREBASE_WINDOWS_STORAGE_BUCKET" \
		--dart-define=GITHUB_CLIENT_ID="$$GITHUB_CLIENT_ID" \
		--dart-define=GITHUB_CLIENT_SECRET="$$GITHUB_CLIENT_SECRET" \
		--dart-define=GITHUB_CALLBACK_URL="$$GITHUB_CALLBACK_URL" \
		--dart-define=GOOGLE_WEB_CLIENT_ID="$$GOOGLE_WEB_CLIENT_ID" \
		--dart-define=GOOGLE_ANDROID_CLIENT_ID="$$GOOGLE_ANDROID_CLIENT_ID" \
		--dart-define=GOOGLE_IOS_CLIENT_ID="$$GOOGLE_IOS_CLIENT_ID" \
			--dart-define=FACEBOOK_APP_ID="$$FACEBOOK_APP_ID" \
		--dart-define=FACEBOOK_APP_SECRET="$$FACEBOOK_APP_SECRET"

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	flutter clean
	flutter pub get 